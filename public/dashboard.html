<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dashboard</title>
<style>
body{font-family:Arial;background:#020617;color:#fff;padding:16px}
.wrap{max-width:800px;margin:auto}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.card{background:#0f172a;padding:12px;border-radius:8px}
button{padding:10px;border:0}
.start{background:#22c55e} .stop{background:#ef4444}
.log{height:180px;overflow:auto;background:#000;padding:8px;font-size:12px}
input[type=range]{width:100%}
@media(max-width:600px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
<h3>Engine Dashboard</h3>

<div class="card">
<label>Threads: <b id="tVal">1</b></label>
<input type="range" min="1" max="5" value="1" id="threads">
<label>Interval (sec): <b id="iVal">2</b></label>
<input type="range" min="1" max="5" value="2" id="interval">
<button class="start" onclick="start()">Start</button>
<button class="stop" onclick="stop()">Stop</button>
</div>

<div class="grid">
<div class="card">Success: <b id="s">0</b></div>
<div class="card">Failed: <b id="f">0</b></div>
<div class="card">Error: <b id="e">0</b></div>
</div>

<div class="card">
<h4>Live Log</h4>
<div class="log" id="log"></div>
</div>
</div>

<script>
let timer=null, running=false;
const s=()=>document.getElementById('s');
const f=()=>document.getElementById('f');
const e=()=>document.getElementById('e');
const log=()=>document.getElementById('log');
const threadsEl=document.getElementById('threads');
const intervalEl=document.getElementById('interval');
threadsEl.oninput=()=>tVal.innerText=threadsEl.value;
intervalEl.oninput=()=>iVal.innerText=intervalEl.value;

function add(msg){
  log().innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}<br>` + log().innerHTML;
}

async function tick(){
  const threads = Number(threadsEl.value);
  for(let i=0;i<threads;i++){
    const r = await fetch('/api/mock-task');
    const d = await r.json();
    if(d.status==='success'){ s().innerText=+s().innerText+1; add('SUCCESS'); }
    else if(d.status==='failed'){ f().innerText=+f().innerText+1; add('FAILED'); }
    else{ e().innerText=+e().innerText+1; add('ERROR'); }
  }
}

function start(){
  if(running) return;
  running=true; add('Engine START');
  timer=setInterval(tick, Number(intervalEl.value)*1000);
}
function stop(){
  running=false; clearInterval(timer); add('Engine STOP');
}
</script>
</body>
</html>
